# 환경 변수 설정 방법

## 방법 1: Firebase Console (가장 간단) ⭐

1. **Firebase Console 접속**
   - https://console.firebase.google.com/project/michael-jesus/functions/env
   - 또는: Firebase Console > Functions > 환경 변수

2. **환경 변수 추가**
   - "환경 변수 추가" 또는 "Add environment variable" 클릭
   - **이름**: `OMR_SERVICE_URL`
   - **값**: `https://omr-service-51418627624.asia-northeast3.run.app`
   - "저장" 클릭

3. **Functions 재배포** (자동으로 적용되지만, 필요시)
   ```powershell
   npm run deploy:functions
   ```

## 방법 2: Firebase CLI

### Functions v2에서 환경 변수 설정

```powershell
# 환경 변수 설정
firebase functions:secrets:set OMR_SERVICE_URL

# 값 입력 (대화형)
# 또는 직접 값 전달:
firebase functions:config:set omr.service_url="https://omr-service-51418627624.asia-northeast3.run.app"
```

**주의**: Functions v2에서는 `defineString`을 사용하므로, Firebase Console에서 설정하는 것이 더 간단합니다.

## 방법 3: 배포 시 직접 설정

`functions/src/omrProcessor.ts`에서 `defineString`을 사용하므로, 배포 시 환경 변수를 설정할 수 있습니다:

```powershell
# 환경 변수와 함께 배포
$env:OMR_SERVICE_URL="https://omr-service-51418627624.asia-northeast3.run.app"
npm run deploy:functions
```

하지만 이 방법은 일시적이므로, **방법 1 (Firebase Console)을 권장**합니다.

## 확인 방법

환경 변수 설정 후:

1. **Functions 로그 확인**
   ```powershell
   firebase functions:log --only processOMR
   ```

2. **앱에서 테스트**
   - 악보 이미지 업로드
   - OMR 처리 확인

3. **로그에서 확인**
   - 로그에 `omrServiceUrl: https://omr-service-...` 표시되면 성공

## 현재 설정해야 할 값

- **변수명**: `OMR_SERVICE_URL`
- **값**: `https://omr-service-51418627624.asia-northeast3.run.app`

## 문제 해결

### 환경 변수가 적용되지 않는 경우

1. Functions 재배포:
   ```powershell
   npm run deploy:functions
   ```

2. Firebase Console에서 환경 변수 확인:
   - https://console.firebase.google.com/project/michael-jesus/functions/env

3. Functions 로그 확인:
   ```powershell
   firebase functions:log
   ```

